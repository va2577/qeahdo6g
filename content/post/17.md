---
title: VMware FusionにWindows 10をクリーンインストールする
date: 2016-01-30T20:51:09+09:00
tags:
  - Mac
  - VMware Fusion
  - Windows
---

今回はすでにVMware FusionにWindows 10がインストールされていて(Windows 8.1からのアップグレード)、そこからWindows 10をクリーンインストールしてみました。

<!--more-->

## 環境

* OS X El Capitan バージョン 10.11.3
* VMware Fusion バージョン 8.1.0 (3272237)
* Windows 10 Pro バージョン 1511

## インストールの前に

インストールの前に以下の点について確認しておきます。

* Windows 10のライセンス
* Windows 10のエディション
* Windows 10にインストールしているソフトウェアのライセンス

### Windows 10のライセンス

> Windows 10 セットアップ中のプロダクト キーの入力を省略できるようになります。無償アップグレードを行ったデバイスでは、Windows 10 は自動でオンライン認証されます。プロダクト キーの入力を省略するオプションは、メディアからブートしセットアップを開始する時のみ有効です。
>
> Q：Windows 10 デバイスのハードウェア構成を変更すると、何が起こりますか？
>
> A：Windows 10 デバイスのハードウェアの構成を変更した場合 (例えば、マザーボードの交換など)、そのデバイスの Windows の再認証が必要になると考えられます。これは以前のバージョンの Windows (Windows 7 や 8.1 など) と同様の動作です。無償アップグレードでは、このようなハードウェア変更の認証リセットのシナリオは Windows 10 の認証に適用されません。
>
> <cite>[アップグレード後の Windows 10 再インストールについて - マイクロソフト コミュニティ](http://answers.microsoft.com/ja-jp/windows/forum/windows_10-windows_install/アップグレ/2131d8c8-60f7-4388-94a4-e4b1ac9b7862?auth=1)</cite>

Windows 7あたりからプロダクト キー(プロダクト IDではない)はWindowsの標準の機能で確認することはできなくなっているようです。
フリー(寄付？)のソフトウェアで確認するように記載されている記事もみますが、それをしなくてもいいと記載されています。
`無償アップグレードを行ったデバイスでは、Windows 10 は自動でオンライン認証されます。`とのことです。

> ライセンス認証と正規の Windows はどのように連係していますか?
> ライセンス認証では、プロダクト キーとハードウェア構成を組み合わせて、Microsoft ソフトウェア ライセンス条項で許可されている台数より多くのコンピューターで Windows が使われていないかを確認します。通常は、大幅にハードウェアを変更しない限り、Windows のライセンス認証は 1 回だけ行う必要があります。
>
> <cite>[正規の Windows - Windows ヘルプ](http://windows.microsoft.com/ja-jp/windows/genuine)</cite>

自動でオンライン認証というのは`プロダクト キーとハードウェア構成を組み合わせて`確認しているということです。
なので、VMware Fusionを使っている場合は注意が必要で、新しい仮想マシンを作成してしまうとライセンス認証できないので、今まで使っていたWindows 10の仮想マシンにクリーンインストールする必要があります。
それから、無償アップグレードした直後だったりして、Windows 10の認証をしていないうちにクリーンインストールを始めてしまうと、Windows 10のプロダクト キーがないことになりますので、クリーンインストール後の認証ができないことになります。
必ずインストールごとに認証の確認をしておく必要があります。

### Windows 10のエディション

Home、Proのうちのどのエディションである確認します。
Enterprise、Educationの場合は無償アップグレードでWindows 10にしたものではないでしょうから、ここで記載するのとはまた手順や扱いが異なるかもしれません。
Windowsから`スタート`-`設定`-`システム`-`バージョン情報`と選択していきます。
エディションのところに`Windows 10 Pro`と表示されていることを確認しました。
これからクリーンインストールするWindows 10もこれと同じエディションを選択する必要があります。

![](/img/17-01.png)

### Windows 10にインストールしているソフトウェアのライセンス

自分の場合はあまりWindows 10にソフトウェアをインストールしていないんですけど、画面キャプチャーのためのSnagitとかをインストールしていたので、製品のホームページで`ソフトウェアを別のコンピューターに移動させる方法`とかを確認して、レジストレーションキーを控えることと、ソフトウェアのアンインストールをしておきました。

## Windows 10のディスク イメージ (ISO ファイル)のダウンロード

[Windows 10 ISO](https://www.microsoft.com/ja-jp/software-download/windows10ISO)からページの案内に従ってダウンロードします。

エディションの選択については普通は`Windows 10`を選択します。
その他の選択について調べた内容を記載しておきます。

> Windows の 10 の N および KN エディションには、メディアに関連するテクノロジ (Windows Media Player) と特定のメディアがプレインストールされているアプリケーション (Groove の音楽、ビデオ、ボイス レコーダー、および Skype) を除いて、Windows の 10 のと同じ機能が含まれます。
>
> <cite>[メディア 10 N の Windows および Windows 10 KN エディション用のパックを機能します。](https://support.microsoft.com/ja-jp/kb/3010081)</cite>

`Windows 10 N`や`Windows 10 KN`というのは、日本以外の国における権利とかの都合上、インストールする機能を制限したもののようです。

> Windows 10 の追加言語をダウンロードし、インストールすると、言語のコントロール パネルを使用して、メニュー、ダイアログ ボックス、その他のユーザー インターフェイス項目を指定した言語で表示できるようになります。
>
> <cite>[言語パック - Microsoft Windows](http://windows.microsoft.com/ja-jp/windows/language-packs#lptabs=win10)</cite>

`Windows 10 Single Language`というのは、1つの言語のみ使えるように制限されたもののようです。
普通のものは言語パックによって複数の言語(英語やフランス語とか)を使えるようになっているようです。

## インストール

### Windows 10のディスク イメージ (ISO ファイル)の設定

仮想マシンはシャットダウンしておきます。
MacのVMware Fusionのメニューバーの`仮想マシン`-`設定`-`CD/DVD(SATA)`を選択します。
`この CD/DVD ドライブは次を使用するように構成されています：`のところからダウンロードしたWindows 10のディスク イメージ (ISO ファイル)を選択します。

![](/img/17-02.png)

設定したディスク イメージ (ISO ファイル)から起動したいので、MacのVMware Fusionのメニューバーの`仮想マシン`-`設定`-`起動ディスク`から`CD/DVD`を選択します。

![](/img/17-03.png)

左上の赤い`×`で設定ウィンドウを閉じます。

### Windows 10のインストール

MacのVMware Fusionのメニューバーの`仮想マシン`-`スタートアップ`から仮想マシンを起動します。
`Press any key to boot from CD or DVD.`と表示されるところで何かキー(enterとか)を押します。

![](/img/17-04.png)

後は画面の案内に従ってインストールを進めていきます。
自分の気になったところは画面とメモを記載しておきます。

ライセンス認証のところは無償アップグレードからのクリーンインストールをしますので、画面に記載されている通り`プロダクト キーがありません(I)`を選択します。
そうすると後で自動的にライセンス認証されます。

![](/img/17-05.png)

インストールするオペレーティングシステムのところは最初に確認したエディションを選択します。

![](/img/17-06.png)

インストールの種類のところはクリーンインストールをしますので`カスタム：Windows のみをインストールする（詳細設定）(C)`を選択しました。

![](/img/17-07.png)

インストール場所のところはクリーンインストールをしますので念のため`ドライブ 0 パーティション 1`の方だけフォーマットをしておきました。
最初に仮想マシンを作った時はVMware Fusionにお任せで作りましたが`OEM (予約済み)`のパーティションが作られていたんですね。
何かわからないですがそのままにしておきました。

![](/img/17-08.png)

インストールが始まると何度か再起動しますのでそのまま待ちます。
自分のは15分もかからずにインストールできていました。

途中のWindowsの初期設定のようなところで`この PC は誰が所有していますか？`と聞かれました。

![](/img/17-09.png)

> この選択は重要で、後で切り替えることは簡単ではありません。

って言われると困るんですけど。
組織で使うのではないため`私が所有しています`を選択しました。
`自分の組織`の方は`組織の ID でサインイン`、`重要なリソースにアクセス`と記載されているところからActive Directoryのドメインに参加することになるんだと思っています。
気になったので試しに`自分の組織`の方を選択してみたら`Azure AD に参加する`と`ドメインに参加する`が選択できるようでした。
やっぱりドメインの関係でした。

インストールが終わったらWindowsから`スタート`-`設定`-`更新とセキュリティ`-`ライセンス認証`を確認します。
`Windows はライセンス認証されています`と表示されていれば大丈夫でしょう。

![](/img/17-10.png)

### VMware Toolsのインストール

そのままだと画面のサイズとかが適正にならないのでVMware Toolsをインストールします。
以下のサイトの手順通りにインストールしました。

> 1. 仮想マシンをパワーオンしてログインします。
> 2. Apple メニュー バーから、仮想マシン > VMware Tools のインストール に移動します。
> 3. プロンプトが表示されたら、インストール をクリックします。
> 4. VMware Tools ボリュームがマウントされ、自動的に開きます。VMware Tools のインストール をダブルクリックします。
> 5. インストール プロセスの承諾、プロセスの開始、および起動ボリュームへの Tools > 2. のインストールの同意に関する最初の 3 つのプロンプトまで、続行 をクリックします。
> 6. インストール をクリックします。
> 7. 管理者パスワードを入力してインストールを許可します。
> 8. インストールを続行する をクリックし、インストール完了後の仮想マシンの再起動を許可します。
> 9. 今すぐ再起動する をクリックします。
>
> <cite>[VMware KB: Mac OS ゲストでの VMware Tools のインストール](http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2078926)</cite>

### Windows 10のディスク イメージ (ISO ファイル)の解除

最後にVMware Fusionの設定を戻しておきます。
仮想マシンはシャットダウンしておきます。

MacのVMware Fusionのメニューバーの`仮想マシン`-`設定`-`CD/DVD(SATA)`を選択します。
`この CD/DVD ドライブは次を使用するように構成されています：`のところから`自動検出`を選択します。
自分の場合はCD/DVDドライブを常に接続していないため`CD/DVDドライブを接続`のチェックも外しておきました。

![](/img/17-11.png)

MacのVMware Fusionのメニューバーの`仮想マシン`-`設定`-`起動ディスク`から`デフォルトにリストア`を選択します。

![](/img/17-12.png)

左上の赤い`×`で設定ウィンドウを閉じます。

## 終わり

これで仮想マシンのWindowsがクリーンになりました。
ライセンスのところは説明を読んでもよくわからないことが多いですが、ちゃんとできました。
このクリーンな状態の仮想マシンのファイルをごっそりバックアップとしてコピーしておこう。

## 参考

* [アップグレード後の Windows 10 再インストールについて - マイクロソフト コミュニティ](http://answers.microsoft.com/ja-jp/windows/forum/windows_10-windows_install/アップグレ/2131d8c8-60f7-4388-94a4-e4b1ac9b7862?auth=1)
* [Windows 10 ISO](https://www.microsoft.com/ja-jp/software-download/windows10ISO)
* [VMware KB: Mac OS ゲストでの VMware Tools のインストール](http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2078926)

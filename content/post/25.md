---
title: radiko.jpã‚’éŒ²éŸ³ã™ã‚‹
date: 2016-02-07T11:51:09+09:00
tags:
  - FLV
  - radiko.jp
  - RTMPDump
  - SWFTOOLS
---

radiko.jpã‚’éŒ²éŸ³ã™ã‚‹ã“ã¨ã«ã¤ã„ã¦èª¿ã¹ã¦ã¿ã¾ã—ãŸã€‚

<!--more-->

## ç’°å¢ƒ

* OS X El Capitan ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 10.11.3
* Homebrew ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 0.9.5
* RTMPDump ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 2.4
* SWFTOOLS ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 0.9.2

## radiko.jpï¼Ÿ

> radiko.jpã¯ã€ãƒ‘ã‚½ã‚³ãƒ³ãŒãã®ã¾ã¾ãƒ©ã‚¸ã‚ªå—ä¿¡æ©Ÿã¨ãªã‚‹ã€ŒIP(Internet Protocol)ã‚µã‚¤ãƒãƒ«ãƒ©ã‚¸ã‚ªã€ã®é…ä¿¡ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚
>
> <cite>[radiko.jp](http://radiko.jp)</cite>

## æº–å‚™

Homebrewã‚’å…ˆã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã™ã€‚

* [Homebrewã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«]({{< relref "2.md" >}})

[RTMPDump](https://rtmpdump.mplayerhq.hu)ã‚’å…ˆã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã™ã€‚

* [RTMPDumpã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«]({{< relref "24.md#æº–å‚™" >}})

[SWFTOOLS](http://www.swftools.org)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
$ brew install swftools
==> Downloading https://homebrew.bintray.com/bottles/swftools-0.9.2_1.el_capitan
######################################################################## 100.0%
==> Pouring swftools-0.9.2_1.el_capitan.bottle.tar.gz
ğŸº  /usr/local/Cellar/swftools/0.9.2_1: 31 files, 6.7M
```

## èªè¨¼

### SWFãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

[player_4.1.0.00.swf](http://radiko.jp/player/swf/player_4.1.0.00.swf)ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

```
$ curl -o player_4.1.0.00.swf http://radiko.jp/player/swf/player_4.1.0.00.swf
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  955k  100  955k    0     0  2938k      0 --:--:-- --:--:-- --:--:-- 2986k
```

### authkeyã®æŠ½å‡º

ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ`player_4.1.0.00.swf`ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èªè¨¼ã«å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–ã‚Šå‡ºã—ã¾ã™ã€‚
SWFTOOLSã®æ©Ÿèƒ½ã§ã‚ã‚‹swfextractã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã„ã¾ã™ã€‚
`player_4.1.0.00.swf`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã«ã¯11ã®ãƒã‚¤ãƒŠãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«(ç”»åƒã¨ã‹)ãŒã‚ã£ã¦ã€ãã®ä¸­ã‹ã‚‰`14`ã®ç•ªå·ãŒã¤ã„ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–ã‚Šå‡ºã™ã‚³ãƒãƒ³ãƒ‰ã«ãªã£ã¦ã„ã¾ã™ã€‚
ã“ã“ã§ã¯`authkey.png`ã¨ã„ã†åå‰ã§å–ã‚Šå‡ºã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¦ã„ã¾ã™ã€‚

```
$ swfextract player_4.1.0.00.swf -b 14 -o authkey.png
```

### AuthTokenã®å–å¾—

èªè¨¼ã«å¿…è¦ãª`AuthToken`ã¨`KeyLength`ã€`KeyOffset`ã‚’å–å¾—ã—ã¾ã™ã€‚
ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯ã€`https://radiko.jp/v2/api/auth1_fms`ã«ç©ºã®ãƒ‡ãƒ¼ã‚¿ã‚’POSTã—ã¦ã„ã‚‹ã‚“ã§ã™ã‘ã©ã€ã“ã®æ™‚ã«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’4ã¤æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚
`X-Radiko-App`ã€`X-Radiko-App-Version`ã€`X-Radiko-Device`ã€`X-Radiko-User`ã®4ã¤ã§ã™ã‘ã©ã€ã“ã‚Œã‚‰ã¯ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã‹ã‚‰radiko.jpã§èãæ™‚ã«ã¯ã“ã®å†…å®¹ã§POSTã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

```
$ curl -d "" -H "X-Radiko-App: pc_1" -H "X-Radiko-App-Version: 2.0.1" -H "X-Radiko-Device: pc" -H "X-Radiko-User: test-stream" https://radiko.jp/v2/api/auth1_fms
X-Radiko-AppType=pc
X-Radiko-AuthToken=X3LzF2RCNEsjXKX76SnGFg
X-Radiko-AuthWait=0
X-Radiko-Delay=0
X-Radiko-KeyLength=16
X-Radiko-KeyOffset=196186

please send a part of key
```

### ã‚­ãƒ¼ã®å–ã‚Šå‡ºã—

å–å¾—ã—ãŸ`X-Radiko-KeyLength`ã€`X-Radiko-KeyOffset`ã‚’ã‚‚ã¨ã«ã€`authkey.png`ã‹ã‚‰ä¸€éƒ¨ã‚­ãƒ¼ã‚’å–ã‚Šå‡ºã—ã¾ã™ã€‚
å–ã‚Šå‡ºã—ãŸã‚‚ã®ã¯ãƒã‚¤ãƒŠãƒªãƒ¼ãªã®ã§ã€[Base64](https://ja.wikipedia.org/wiki/Base64)ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ã—ã¾ã™ã€‚
ä¸€ç•ªä¸‹ã®è¡Œã«å‡ºåŠ›ã•ã‚Œã‚‹ã®ãŒçµæœã§ã™ã€‚

```
$ dd if=authkey.png ibs=1 skip=196186 count=16 | base64
16+0 records in
0+1 records out
16 bytes transferred in 0.000035 secs (456523 bytes/sec)
wDIeTo0gxlgpyf8AP5UAFw==
```

### èªè¨¼

ã“ã“ã¾ã§ã§æƒãˆãŸ`X-Radiko-AuthToken`ã€`X-Radiko-Partialkey`ã‚’ã‚‚ã¨ã«èªè¨¼ã‚’ã—ã¾ã™ã€‚
ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯ã€`https://radiko.jp/v2/api/auth2_fms`ã«ç©ºã®ãƒ‡ãƒ¼ã‚¿ã‚’POSTã—ã¦ã„ã‚‹ã‚“ã§ã™ã‘ã©ã€ã“ã®æ™‚ã«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’6ã¤æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚
`X-Radiko-App`ã€`X-Radiko-App-Version`ã€`X-Radiko-Device`ã€`X-Radiko-User`ã¯`auth1_fms`ã«POSTã—ãŸæ™‚ã¨åŒã˜ã§ã™ã€‚
`X-Radiko-Authtoken`ã¯`auth1_fms`ã§å–å¾—ã—ãŸ`X-Radiko-AuthToken`ã§ã™ã€‚
`X-Radiko-Partialkey`ã¯ä¸€ã¤å‰ã®ã‚³ãƒãƒ³ãƒ‰ã§å–å¾—ã—ãŸæ–‡å­—åˆ—ã§ã™ã€‚
èªè¨¼ãŒæˆåŠŸã™ã‚‹ã¨åœ°åŸŸãŒå–å¾—ã§ãã¾ã™ã€‚

```
$ curl -d "" -H "X-Radiko-App: pc_1" -H "X-Radiko-App-Version: 2.0.1" -H "X-Radiko-Device: pc" -H "X-Radiko-User: test-stream" -H "X-Radiko-Authtoken: X3LzF2RCNEsjXKX76SnGFg" -H "X-Radiko-Partialkey: wDIeTo0gxlgpyf8AP5UAFw==" https://radiko.jp/v2/api/auth2_fms


JP13,æ±äº¬éƒ½,tokyo Japan
```

## æ”¾é€å±€ã®URL

åœ°åŸŸãŒå–å¾—ã§ããŸã‚‰ã€æ”¾é€å±€ã®IDã¯æ¬¡ã®URLã‹ã‚‰å–å¾—ã§ãã¾ã™ã€‚`JP13`ã®ã¨ã“ã‚ãŒåœ°åŸŸãªã®ã§ã€ä¸€ã¤ä¸Šã®ã‚³ãƒãƒ³ãƒ‰ã§å–å¾—ã—ãŸåœ°åŸŸã«å¤‰ãˆã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

```markdown
http://radiko.jp/v2/station/list/JP13.xml
```

ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨XMLãªã®ã§åˆ†ã‹ã‚Šã¥ã‚‰ã„ã§ã™ãŒã€å¿…è¦ãªã®ã¯`<id>`ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ç®‡æ‰€ã§ã€TBSãƒ©ã‚¸ã‚ªã®å ´åˆã¯`TBS`ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<stations area_id="JP13" area_name="TOKYO JAPAN">
 <station>
    <id>TBS</id>
    <name>TBSãƒ©ã‚¸ã‚ª</name>
    <ascii_name>TBS RADIO</ascii_name>
<!-- ...ç•¥... -->
```

æ”¾é€å±€ã®IDãŒã‚ã‹ã£ãŸã‚‰ã€æ¬¡ã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦æ”¾é€å±€ã®URLã‚’å–å¾—ã—ã¾ã™ã€‚`TBS`ã®ã¨ã“ã‚ã¯ãã‚Œãã‚Œã®æ”¾é€å±€ã®IDã«å¤‰ãˆã¾ã™ã€‚

```markdown
http://radiko.jp/v2/station/stream/TBS.xml
```

ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨æ”¾é€å±€ã®URLãŒã‚ã‹ã‚Šã¾ã™ã€‚`<item>`ãŒ2ã¤ã‚ã‚Šã¾ã™ãŒã€ã©ã¡ã‚‰ã‚‚åŒã˜ã‚ˆã†ãªã®ã§ã€ä¸Šã®æ–¹ã‚’ä½¿ã†ã“ã¨ã«ã—ã¾ã™ã€‚

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<url>
  <item>rtmpe://f-radiko.smartstream.ne.jp/TBS/_definst_/simul-stream.stream</item>
  <item>rtmpe://f-radiko.smartstream.ne.jp/TBS/_definst_/simul-stream.stream</item>
</url>
```

æ”¾é€å±€ã®URLã¯ä¸€åº¦è‡ªåˆ†ã®åœ°åŸŸã®æ”¾é€å±€ã‚’èª¿ã¹ãŸã‚‰ã‚ã¾ã‚Šå¤‰ã‚ã‚‹ã“ã¨ã¯ãªã„ã¨æ€ã„ã¾ã™ã®ã§ã€æ¬¡å›ã‹ã‚‰ã¯åŒã˜URLã‚’ä½¿ã†ã“ã¨ã§å¤§ä¸ˆå¤«ã‹ãªã¨æ€ã£ã¦ã„ã¾ã™ã€‚

## éŒ²éŸ³

```
$ rtmpdump -r rtmpe://f-radiko.smartstream.ne.jp/TBS/_definst_/simul-stream.stream -a TBS/_definst_ -W http://radiko.jp/player/swf/player_4.1.0.00.swf -C S:"" -C S:"" -C S:"" -C S:"X3LzF2RCNEsjXKX76SnGFg" -v -o filename.flv -B 60
RTMPDump v2.4
(c) 2010 Andrej Stepanchuk, Howard Chu, The Flvstreamer Team; license: GPL
Connecting ...
WARNING: Trying different position for server digest!
INFO: Connected...
Starting Live Stream
For duration: 60.000 sec
INFO: Metadata:
365.770 kB / 60.03 sec
Download complete
```

`-r`ã¨`-a` ã®ã¨ã“ã‚ã«ã‚ã‚‹`TBS`ã¯æ”¾é€å±€ã®IDã«å¤‰ãˆã¾ã™ã€‚
`-C S:"X3LzF2RCNEsjXKX76SnGFg"` ã®ã¨ã“ã‚ã¯`auth1_fms`ã§å–å¾—ã—ãŸ`X-Radiko-AuthToken`ã«å¤‰ãˆã¾ã™ã€‚
`-o filename.flv` ã®ã¨ã“ã‚ã¯ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«åã§ä¿å­˜ã™ã‚‹ã‚ˆã†ã«åå‰ã‚’å¤‰ãˆã¾ã™ã€‚
`-B 60` ã®ã¨ã“ã‚ã¯60ç§’ã ã‘ä¿å­˜ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã®ã§ã€ä»»æ„ã®æ™‚é–“ä¿å­˜ã™ã‚‹ã‚ˆã†ã«å¤‰ãˆã¾ã™ã€‚

## çµ‚ã‚ã‚Š

radiko.jpã¯èªè¨¼ãŒå¿…è¦ã§ã™ã‘ã©ã€ã‚‰ã˜ã‚‹â˜…ã‚‰ã˜ã‚‹ã¨åŒã˜ã‚ˆã†ã«ä¿å­˜ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

## å‚è€ƒ

* [radiko.jp](http://radiko.jp)

## 9 February 2016 è¿½è¨˜

FLVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰AACãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŠ½å‡ºã™ã‚‹ã“ã¨ã«ã¤ã„ã¦æ›¸ã„ã¦ã¿ã¾ã—ãŸã€‚

* [FLVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰AACãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŠ½å‡ºã™ã‚‹]({{< relref "27.md" >}})

## 10 February 2016 è¿½è¨˜

iTunesã§å†ç”Ÿã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¾ã§ã‚’æ›¸ã„ã¦ã¿ã¾ã—ãŸã€‚

* [FLVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰AACãƒ•ã‚¡ã‚¤ãƒ«ã«ã€AACãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰M4Aãƒ•ã‚¡ã‚¤ãƒ«ã«ç„¡åŠ£åŒ–ã§å¤‰æ›ã™ã‚‹]({{< relref "28.md" >}})
